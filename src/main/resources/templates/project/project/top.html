
<h1 class="page-header">プロジェクトの画面です</h1>

<div class="row">
	<div class="col-md-6">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<div>環境</div>
			</div>
			<div class="panel-body">
				<form class="form-inline" action="#" th:action="@{/project/environment/regist}" th:object="${environmentForm}" method="post">
					<input type="hidden" th:field="*{projectName}" />
					<input type="text" class="form-control" th:field="*{environmentName}" placeholder="environmentName" />
					<input type="submit" class="btn btn-primary" value="登録" />
				</form>
				
				<br />
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>#</th>
							<th>environment</th>
							<th>Delete</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="environment,iterStat : ${environmentList}">
							<td>
								<div class="text-center" th:text="${iterStat.count}" />
							</td>
							<td>
								<a th:href="@{/project/environment/view(projectName=${environment.projectName}, environmentName=${environment.environmentName})}"
								th:text="${environment.environmentName}" />
							</td>
							<td class="text-center">
								<form th:action="@{/project/environment/delete}" th:object="${environmentKey}" method="POST">
									<input type="hidden" th:field="*{projectName}" />
									<input type="hidden" name="environmentName" th:value="${environment.environmentName}" />
									<button type="submit" class="btn btn-danger btn-xs">
										<span class="glyphicon glyphicon-trash" aria-hidden="true" />
									</button>
								</form>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="col-md-6">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<div>サーバ</div>
			</div>
			<div class="panel-body">
				<form class="form-inline" action="#" th:action="@{/project/server/regist}" th:object="${serverForm}" method="post">
					<input type="hidden" th:field="*{projectName}" />
					<select class="form-control" th:field="*{environmentName}">
						<option th:each="environment : ${environmentList}" th:value="${environment.environmentName}" th:label="${environment.environmentName}" />
					</select>
					<input type="text" class="form-control" th:field="*{serverName}" placeholder="serverName" />
					<input type="submit" class="btn btn-primary" value="登録" />
				</form>
				
				<br />		
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>#</th>
							<th>environment</th>
							<th>server</th>
							<th>Delete</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="server,iterStat : ${serverList}">
							<td>
								<div class="text-center" th:text="${iterStat.count}" />
							</td>
							<td>
								<a th:href="@{/project/environment/view(projectName=${server.projectName}, environmentName=${server.environmentName})}"
								th:text="${server.environmentName}" />
							</td>
							<td>
								<a th:href="@{/project/server/view(projectName=${server.projectName}, serverName=${server.serverName})}"
								th:text="${server.serverName}" />
							</td>
							<td class="text-center">
								<form th:action="@{/project/server/delete}" th:object="${serverKey}" method="POST">
									<input type="hidden" th:field="*{projectName}" />
									<input type="hidden" name="serverName" th:value="${server.serverName}" />
									<button type="submit" class="btn btn-danger btn-xs">
										<span class="glyphicon glyphicon-trash" aria-hidden="true" />
									</button>
								</form>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<div class="row">
	<div class="col-md-6">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<div>ロール</div>
			</div>
			<div class="panel-body">
				<form class="form-inline" action="#" th:action="@{/project/role/regist}" th:object="${roleForm}" method="post">
					<input type="hidden" th:field="*{projectName}" />
					<input type="text" class="form-control" th:field="*{roleName}" placeholder="roleName" />
					<input type="submit" class="btn btn-primary" value="登録" />
				</form>
				
				<br />
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>#</th>
							<th>role</th>
							<th>Delete</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="role,iterStat : ${roleList}">
							<td>
								<div class="text-center" th:text="${iterStat.count}" />
							</td>
							<td>
								<a th:href="@{/project/role/view(projectName=${role.projectName}, roleName=${role.roleName})}"
								th:text="${role.roleName}" />
							</td>
							<td class="text-center">
								<form th:action="@{/project/role/delete}" th:object="${roleKey}" method="POST">
									<input type="hidden" th:field="*{projectName}" />
									<input type="hidden" name="roleName" th:value="${role.roleName}" />
									<button type="submit" class="btn btn-danger btn-xs">
										<span class="glyphicon glyphicon-trash" aria-hidden="true" />
									</button>
								</form>
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="col-md-6">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<div>グローバルロール</div>
			</div>
			<div class="panel-body">
				<form class="form-inline" action="#" th:action="@{/project/globalRole/regist}" th:object="${globalRoleRelationForm}" method="post">
					<input type="hidden" th:field="*{projectName}" />
					<select class="form-control" th:field="*{roleName}">
						<option th:each="globalRole : ${globalRoleList}" th:value="${globalRole.roleName}" th:label="${globalRole.roleName}" />
					</select>
					<input type="submit" class="btn btn-primary" value="登録" />
				</form>		
				
				<br />
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>#</th>
							<th>role</th>
							<th>tagName</th>
							<th>changeTagName</th>
							<th>Update</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="globalRoleRelation,iterStat : ${globalRoleRelationList}">
							<td>
								<div class="text-center" th:text="${iterStat.count}" />
							</td>
							<td>
								<div th:text="${globalRoleRelation.roleName}" />
							</td>
							<td>
								<div th:text="${globalRoleRelation.tagName}" />
							</td>
							
							
							<form th:action="@{/project/globalRole/update}" th:object="${globalRoleRelationTagUpdateForm}" method="POST">
								<input type="hidden" th:field="*{projectName}" />
								<input type="hidden" name="roleName" th:value="${globalRoleRelation.roleName}" />
								<td>
									<select class="form-control" th:field="*{tagName}">
										<option th:each="tag : ${globalRoleRelation.tagList}" th:value="${tag}" th:label="${tag}" />
									</select>
								</td>
								<td class="text-center">
									<input class="btn btn-primary" type="submit" value="Update" />
								</td>
							</form>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<div class="panel panel-primary">
	<div class="panel-heading">
		<div>GITレポジトリコミット</div>
	</div>
	<div class="panel-body">
		<blockquote class="bg-info"><strong><span th:text="${project.repositoryUrl}" /></strong></blockquote>
		
		<form class="form-inline" action="#" th:action="@{/project/git/commit}" th:object="${gitForm}" method="post">
			<input type="hidden" th:field="*{projectName}" />
			<input type="text" class="form-control" th:field="*{userName}" placeholder="userName" />
			<input type="password" class="form-control" th:field="*{password}" placeholder="password" />
			<input type="text" class="form-control" th:field="*{comment}" placeholder="comment" />
			<input type="submit" class="btn btn-primary" value="コミット" />
		</form>
	</div>
</div>

<div class="panel panel-primary">
	<div class="panel-heading">
		<div>Jenkins</div>
	</div>
	<div class="panel-body">
		<div class="panel panel-primary">
			<div class="panel-heading">
				<div>Jenkins登録</div>
			</div>
			<div class="panel-body">
				<form class="form-inline" action="#" th:action="@{/project/jenkins/regist}" th:object="${jenkinsInfoForm}" method="post">
					<input type="hidden" th:field="*{projectName}" />
					<input type="text" class="form-control" th:field="*{jenkinsIpAddress}" placeholder="jenkinsIpAddress" />
					<input type="text" class="form-control" th:field="*{jenkinsPort}" placeholder="jenkinsPort" />
					<input type="text" class="form-control" th:field="*{jenkinsJobName}" placeholder="jenkinsJobName" />
					<input type="submit" class="btn btn-primary" value="更新" />
				</form>
			</div>
		</div>
		
		<div class="row">
			<div class="col-md-6">
				<div class="panel panel-primary">
					<div class="panel-heading">
						<div>タスク適用（グループ別適用）</div>
					</div>
					<div class="panel-body">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>#</th>
									<th>environment</th>
									<th>group</th>
									<th>Build</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="group,iterStat : ${groupList}">
									<td>
										<div class="text-center" th:text="${iterStat.count}" />
									</td>
									<td>
										<div th:text="${group.environmentName}" />
									</td>
									<td>
										<div th:text="${group.groupName}" />
									</td>
									<td class="text-center">
										<a th:href="@{/project/apply/view(projectName=${project.projectName}, environmentName=${group.environmentName}, groupName=${group.groupName})}"
										th:text="Build" />
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="panel panel-primary">
					<div class="panel-heading">
						<div>タスク適用（サーバ別適用）</div>
					</div>
					<div class="panel-body">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>#</th>
									<th>environment</th>
									<th>group</th>
									<td>server</td>
									<th>Build</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="server,iterStat : ${serverbuildList}">
									<td>
										<div class="text-center" th:text="${iterStat.count}" />
									</td>
									<td>
										<div th:text="${server.environmentName}" />
									</td>
									<td>
										<div th:text="${server.groupName}" />
									</td>
									<td>
										<div th:text="${server.serverName}" />
									</td>
									<td class="text-center">
										<a th:href="@{/project/applyServer/view(projectName=${server.projectName}, environmentName=${server.environmentName}, groupName=${server.groupName}, serverName=${server.serverName})}"
										th:text="Build" />
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		
		
		<div class="panel panel-primary">
			<div class="panel-heading">
				<div>適用履歴</div>
			</div>
			<div class="panel-body">			
				<table class="table table-bordered">
					<thead>
						<tr>
							<th>#</th>
							<th>environment</th>
							<th>group</th>
							<th>server</th>
							<th>tagName</th>
							<th>tagComment</th>
							<th>applyTime</th>
							<th>result</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="applyHistory,iterStat : ${applyHistoryList}">
							<td>
								<div class="text-center" th:text="${iterStat.count}" />
							</td>
							
							
							<td>
								<div th:text="${applyHistory.environmentName}" />
							</td>
							<td>
								<div th:text="${applyHistory.groupName}" />
							</td>
							<td>
								<div th:text="${applyHistory.serverName}" />
							</td>
							<td>
								<div th:text="${applyHistory.tagName}" />
							</td>
							<td>
								<div th:text="${applyHistory.tagComment}" />
							</td>
							<td>
								<div th:text="${#dates.format(applyHistory.applyTime, 'yyyy/MM/dd HH:mm:ss')}" />
							</td>
							<td class="text-center">
								<a th:href="@{/project/jenkins/result(projectName=${applyHistory.projectName}, applyHistroyId=${applyHistory.applyHistroyId})}"
								th:text="result" />
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<div class="panel panel-primary">
	<div class="panel-heading">
		<div>テストデータダウンロード</div>
	</div>
	<div class="panel-body">				
		<table class="table table-bordered">
			<thead>
				<tr>
					<th>#</th>
					<th>environment</th>
					<th>group</th>
					<th>server</th>
					<th>Download</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="server,iterStat : ${serverbuildList}">
					<td>
						<div class="text-center" th:text="${iterStat.count}" />
					</td>
					<td>
						<div th:text="${server.environmentName}" />
					</td>
					<td>
						<div th:text="${server.groupName}" />
					</td>
					<td>
						<div th:text="${server.serverName}" />
					</td>
					<td class="text-center">
						<form method="POST" enctype="multipart/form-data" th:action="@{/project/testZip}" th:object="${serverRelationKey}">
							<input type="hidden" th:field="*{projectName}" />
							<input type="hidden" name="environmentName" th:value="${server.environmentName}" />
							<input type="hidden" name="groupName" th:value="${server.groupName}" />
							<input type="hidden" name="serverName" th:value="${server.serverName}" />
								<input type="submit" value="Download" />
						</form>
					</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>
